[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "export SHELL=/bin/bash",
  "curl -fsSL https://get.pnpm.io/install.sh | sh -",
  "export PATH=\"$HOME/.local/share/pnpm:$PATH\"",
  "cd ../..",
  "pnpm install",
  "pnpm --filter @loan-platform/shared-types build",
  "cd services/loan-service",
  "pnpm build",
  "cp dist-register-paths.js dist/register-paths.js || echo 'Copy failed, continuing...'",
  "ls -la dist/ || echo 'dist folder check'"
]

[start]
cmd = "cd services/loan-service && node start-simple.js"

